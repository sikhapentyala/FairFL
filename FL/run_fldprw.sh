#!/bin/bash


python3 server.py &
sleep 2 # Sleep for 2s to give the server enough time to start
#users='91'
#users=[6,92,110,8,84,82,3,48,79,61,88,87,86,50,78,32,30,80,67,11,103,27,71,56,95,116,44,111,93,100,109,41,99,16,22,26,117,15,49,9,112,21,51,54,35,45,118,72,85,5,115,113,10,114,60,70,66,89,63,81,38,83,7,46,29,55,13,68,31,77,101,17,62,36,28,12,53,40,37,47,20,105,75,97,2,59,64,23,90,42,98,24,4,108,19,58,33,119,39,120,94,96,76,43,102,73,74,18,1,34,14,65,107]
#users="6 92" # 110 8 84 82 3 48 79 61 88 87 86 50 78 32 30 80 67 11 103 27 71 56 95 116 44 111 93 100 109 41 99 16 22 26 117 15 49 9 112 21 51 54 35 45 118 72 85 5 115 113 10 114 60 70 66 89 63 81 38 83 7 46 29 55 13 68 31 77 101 17 62 36 28 12 53 40 37 47 20 105 75 97 2 59 64 23 90 42 98 24 4 108 19 58 33 119 39 120 94 96 76 43 102 73 74 18 1 34 14 65 107"
users="77 72 33 62 102 93 103 71 90 96 113 4 58 85 15 48 117 108 49 99 54 26 20 80 11 87 28 68 59 35 119 7 100 17 84 97 38 39 98 50 89 105 83 22 12 19 24 51 120 92 74 56 23 110 9 115 78 61 37 82 94 16 79 95 40 81 6 18 47 114 86 112 8 63 70 76 41 5 45 109 27 42 13 53 44 73 46 32 31 88 60 43 69 66 64 75 10 3 116 29 101 30 118 21 36 111 2 55 67"

#for i in `seq 1 120`; do
for i in $users
do
    # shellcheck disable=SC1072
    echo "Starting client $i"
    python3 client.py --partition=${i} --dpsgd=True &
done

# This will allow you to use CTRL+C to stop all background processes
trap "trap - SIGTERM && kill -- -$$" SIGINT SIGTERM
# Wait for all background processes to complete
wait
